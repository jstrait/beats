#!/usr/bin/env ruby

$:.unshift File.dirname(__FILE__)
require "rubygems"
require "optparse"
require "yaml"
require "wavefile"
require "lib/beats"
require "lib/song"
require "lib/songparser"
require "lib/songoptimizer"
require "lib/songsplitter"
require "lib/kit"
require "lib/pattern"
require "lib/track"
require "lib/wavefileextended"

def parse_options
  options = {:split => false, :pattern => nil}

  optparse = OptionParser.new do |opts|
    opts.on('-s', '--split', "Save each track to an individual wave file") do
      options[:split] = true
    end

    opts.on('-p', '--pattern PATTERN_NAME', "Output a single pattern instead of the whole song" ) do |p|
      options[:pattern] = p
    end
  
    opts.on('-v', '--version', "Display version number and exit") do
      puts "BEATS v#{Beats::BEATS_VERSION}"
      exit
    end
  
    opts.on( '-h', '--help', "Display this screen and exit" ) do
      puts opts
      exit
    end
  end
  optparse.parse!

  return options
end

options = parse_options
input_file_name = ARGV[0]
output_file_name = ARGV[1]

beats = Beats.new(input_file_name, output_file_name, options)
output_message = beats.run()
puts output_message